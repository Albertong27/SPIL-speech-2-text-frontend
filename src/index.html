<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="./output.css" rel="stylesheet" />
    <link href="./css/all.min.css" rel="stylesheet" />
  </head>
  <body class="h-screen">
    <div
      class="flex h-[calc(100dvh-116px)] flex-col items-center justify-end"
      id="chat-section"
    >
      <div
        id="chat-buble"
        class="w-full space-y-4 overflow-auto px-8 pt-8 lg:px-0"
      ></div>
    </div>
    <div class="flex flex-col items-center justify-end gap-3 py-8">
      <div
        class="flex w-full items-center gap-2 px-8 lg:w-1/2 lg:px-0"
        id="badge"
      ></div>
      <form id="ask-chatbot" class="flex w-full gap-3 px-8 lg:w-1/2 lg:px-0">
        <input
          class="input w-full rounded-xl"
          id="input"
          type="text"
          id="string"
          name="string"
          placeholder="Ask anything"
          autocomplete="off"
          required
        />
        <div class="flex gap-3">
          <label class="btn btn-square rounded-xl">
            <i class="fa-solid fa-paperclip"></i>
            <input type="file" name="file" id="file" hidden />
          </label>
          <button id="microphone" class="btn btn-square rounded-xl">
            <i class="fa-solid fa-microphone"></i>
          </button>
        </div>
      </form>
    </div>
  </body>
</html>

<script>
  const form = document.querySelector("#ask-chatbot");
  const myBadge = document.getElementById("badge");
  const myChatBox = document.getElementById("chat-section");
  const myFile = document.getElementById("file");
  const myInput = document.getElementById("input");
  const myMicrophone = document.getElementById("microphone");
  const temp_microphone = myMicrophone.innerHTML;
  let fileName;
  let myChatBubble;
  let temp_badge = myBadge.innerHTML;

  function adjustHeight(status) {
    const a = "h-[calc(100dvh-148px)]";
    const b = "h-[calc(100dvh-116px)]";
    myChatBox.classList.add(status === "enlarge" ? a : b);
    myChatBox.classList.remove(status === "dwindle" ? a : b);
  }

  function myResetFile() {
    myFile.value = "";
    if (!myFile.value) {
      fileName = "";
      myBadge.innerHTML = temp_badge;
    }
    adjustHeight("dwindle");
  }

  window.onload = function () {
    myFile.addEventListener("change", (event) => {
      event.preventDefault();
      const files = event.target.files;
      fileName = files[0].name;
      myBadge.innerHTML = `
        <div class="badge badge-outline badge-success">
          ${fileName.length > 30 ? `${fileName.slice(0, 30)}...` : fileName}
        </div>
        <button onClick="myResetFile()" class="btn btn-circle btn-outline btn-error btn-sm">
          <i class="fa-solid fa-xmark"></i>
        </button>
      `;
      adjustHeight("enlarge");
    });
  };

  myInput.addEventListener("input", () => {
    myMicrophone.innerHTML = myInput.value
      ? `
        <button type="submit" id="send" class="btn btn-square rounded-xl !bg-green-600 !text-white">
          <i class="fa-solid fa-paper-plane"></i>
        </button>
      `
      : temp_microphone;
  });

  async function sendData() {
    const formData = new FormData(form);

    try {
      if (formData.get("string")) {
        myChatBubble = document.getElementById("chat-buble");
        myChatBubble.innerHTML += `
        ${
          fileName
            ? `
            <div class="flex justify-end w-1/2 mx-auto mb-2">
              <div class="badge badge-outline badge-success">
                ${fileName.length > 30 ? `${fileName.slice(0, 30)}...` : fileName}
              </div> 
            </div>
          `
            : ""
        }
          <div id="chat-buble" class="chat chat-end mx-auto w-full lg:w-1/2">
            <div class="chat-bubble rounded-xl !bg-green-600 !text-white">
              ${formData.get("string")}
            </div>
          </div>
        `;
        myInput.value = "";
        myMicrophone.innerHTML = temp_microphone;
        myChatBubble.scrollTop = myChatBubble.scrollHeight;
        myResetFile();
      }
    } catch (e) {
      console.error(e);
    }
  }

  form.addEventListener("submit", (event) => {
    event.preventDefault();
    sendData();
  });
</script>
