<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Live Audio Transcription</title>
    <link href="./input.css" rel="stylesheet" />
    <link href="./output.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
    />
  </head>
  <body>
    <section class="flex justify-center">
      <!-- left -->
      <div class="relative min-w-[25%] duration-300 ease-in-out" id="myTopnav">
        <div class="fixed min-w-[25%]">
          <div class="mx-auto flex h-screen max-w-[85%] flex-col gap-12 pt-8">
            <img
              src="https://www.spil.co.id/img/spil_logo.581f4306.svg"
              width="50"
            />
            <div class="space-y-4">
              <ul class="menu w-full rounded-box bg-base-200">
                <li><h2 class="menu-title">Live Transcript</h2></li>
                <ul>
                  <li><button>Amazon Web Service (AWS)</button></li>
                  <li><button>Vertex AI</button></li>
                </ul>
              </ul>

              <ul class="menu w-full rounded-box bg-base-200">
                <li><h2 class="menu-title">Recorded Transcript</h2></li>
                <ul>
                  <li><button>URL</button></li>
                  <li><button>Audio File</button></li>
                </ul>
              </ul>
            </div>

            <p
              class="absolute bottom-8 left-1/2 -translate-x-1/2 transform text-sm"
            >
              Â© 2025 PT SPIL
            </p>
          </div>
        </div>
      </div>

      <!-- right -->
      <div class="flex w-full flex-col gap-10 p-8">
        <nav
          class="navbar sticky top-8 z-50 gap-2 rounded-3xl bg-base-100 p-4 shadow-lg"
        >
          <!-- start record -->
          <div class="flex-none">
            <button
              class="btn btn-primary rounded-2xl"
              id="startListening"
              onclick="startRecording()"
            >
              <i
                class="fa-solid fa-microphone fa-sm"
                style="color: #ffffff"
              ></i>
              Start Listening with Vertex
            </button>
          </div>
          <!-- stop record -->
          <div class="flex-1">
            <button
              class="btn btn-disabled btn-error rounded-2xl !text-white"
              id="stopListening"
              onclick="stopRecording()"
            >
              <i class="fa-solid fa-stop fa-sm" style="color: #ffffff"></i>
              Stop Listening
            </button>
          </div>
          <!-- hamburger menu -->
          <div class="flex-none">
            <button class="btn btn-square rounded-xl" onclick="openCloseNav()">
              <i class="fa-solid fa-bars" style="color: #000000"></i>
            </button>
          </div>
        </nav>

        <!-- transcription result -->
        <div class="mx-auto w-[600px]">
          <div class="w-full space-y-4">
            <div class="flex items-center gap-4" id="getDate"></div>
            <p class="text-sm">
              <span id="final" class="font-semibold"></span>
              <span id="transcription"></span>
            </p>
          </div>
        </div>
      </div>
    </section>

    <script>
      // open close navbar
      function openCloseNav() {
        var x = document.getElementById("myTopnav");
        var before = "relative min-w-[25%] ";
        var delay = "duration-300 ease-in-out";
        if (x.className === before + delay) {
          x.className = "fixed translate-x-[-100%] w-full " + delay;
        } else {
          x.className = before + delay;
        }
      }

      let recognition = null;
      let isRecording = false;

      function initializeSpeechRecognition() {
        if (!recognition) {
          recognition = new (window.SpeechRecognition ||
            window.webkitSpeechRecognition)();
          recognition.lang = "id-ID";
          recognition.continuous = true;
          recognition.interimResults = true;

          recognition.onstart = () => updateStatus("Recording...");
          recognition.onresult = (e) => {
            document.getElementById("transcription").textContent = Array.from(
              e.results,
            )
              .map((r) => r[0].transcript)
              .join(" ");
          };
          recognition.onerror = (e) => updateStatus("Error: " + e.error);
          recognition.onend = () =>
            isRecording ? recognition.start() : updateStatus("Stopped");
        }
      }

      function updateStatus(status) {
        document.getElementById("status").innerText = status;
      }

      function startRecording() {
        initializeSpeechRecognition();
        recognition.start();
        isRecording = true;
        toggleButtons(true);
        document.getElementById("getDate").innerHTML = `
        <div class="flex items-center gap-2">
          <div class="avatar placeholder h-fit w-fit">
            <div class="w-10 rounded-full bg-neutral text-neutral-content">
              <i
                class="fa-solid fa-calendar fa-sm"
                style="color: #ffffff"
              ></i>
            </div>
          </div>
          <p class="text-sm">${new Date()}</p>
        </div>
        `;
      }

      function stopRecording() {
        recognition.stop();
        isRecording = false;
        toggleButtons(false);
      }

      const startListening = document.getElementById("startListening");
      const stopListening = document.getElementById("stopListening");

      function toggleButtons(isRecording) {
        if (isRecording) {
          startListening.classList.add("hidden");
          stopListening.classList.remove("btn-disabled");
        } else {
          startListening.classList.remove("hidden");
          stopListening.classList.add("btn-disabled");
        }
      }
    </script>
  </body>
</html>
