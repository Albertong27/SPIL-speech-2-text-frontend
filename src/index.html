<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="./output.css" rel="stylesheet" />
    <link href="./css/all.min.css" rel="stylesheet" />
  </head>
  <body class="h-screen">
    <div
      class="flex h-[calc(100dvh-116px)] flex-col items-center justify-end"
      id="chat-section"
    >
      <div
        id="chat-buble"
        class="w-full gap-4 overflow-auto px-8 pt-8 lg:w-1/2 lg:px-0"
      ></div>
    </div>
    <div class="flex flex-col items-center justify-end gap-3 py-8">
      <div class="w-full px-8 lg:w-1/2 lg:px-0" id="badge"></div>
      <form id="ask-chatbot" class="flex w-full gap-3 px-8 lg:w-1/2 lg:px-0">
        <input
          class="input w-full rounded-xl"
          id="input"
          type="text"
          id="string"
          name="string"
          placeholder="Ask anything"
          autocomplete="off"
          required
        />
        <div class="flex gap-3">
          <label class="btn btn-square rounded-xl">
            <i class="fa-solid fa-paperclip"></i>
            <input type="file" name="file" id="file" hidden />
          </label>
          <button id="microphone" class="btn btn-square rounded-xl">
            <i class="fa-solid fa-microphone"></i>
          </button>
        </div>
      </form>
    </div>
  </body>
</html>

<script>
  window.onload = function () {
    document.getElementById("file").addEventListener("change", (event) => {
      const files = event.target.files;
      const fileName = files[0].name;
      const chatBox = document.getElementById("chat-section");
      document.getElementById("badge").innerHTML = `
        <div class="badge badge-outline badge-success">
          ${fileName.length > 30 ? `${fileName.slice(0, 30)}...` : fileName}
        </div>
      `;
      chatBox.classList.remove("h-[calc(100dvh-116px)]");
      chatBox.classList.add("h-[calc(100dvh-143px)]");
    });
  };

  const myInput = document.getElementById("input");
  const myMicrophone = document.getElementById("microphone");
  const temp = myMicrophone.innerHTML;
  myInput.addEventListener("input", () => {
    myMicrophone.innerHTML = myInput.value
      ? `
        <button type="submit" id="send" class="btn btn-square rounded-xl !bg-green-600 !text-white">
          <i class="fa-solid fa-paper-plane"></i>
        </button>
      `
      : temp;
  });

  const form = document.querySelector("#ask-chatbot");
  async function sendData() {
    const formData = new FormData(form);

    try {
      if (formData.get("string")) {
        myChatBubble = document.getElementById("chat-buble");
        myChatBubble.innerHTML += `
          <div id="chat-buble" class="chat chat-end">
            <div class="chat-bubble rounded-xl !bg-green-600 !text-white">${formData.get("string")}</div> 
          </div>`;
        myInput.value = "";
        myMicrophone.innerHTML = temp;
      }
    } catch (e) {
      console.error(e);
    }
  }

  // Take over form submission
  form.addEventListener("submit", (event) => {
    event.preventDefault();
    sendData();
  });
</script>
